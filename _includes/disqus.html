{% if site.disqus.shortname and page.comments != false %}
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = '{{ page.url | absolute_url }}';
      this.page.identifier = '{{ page.url | absolute_url }}';
      
      // Set Disqus theme based on current site theme
      var currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
      this.page.colorScheme = currentTheme === 'dark' ? 'dark' : 'light';
    };
    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://{{ site.disqus.shortname }}.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
    
    // Listen for theme changes and reload Disqus if needed
    if (window.MutationObserver) {
      var observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          if (mutation.attributeName === 'data-theme' && window.DISQUS) {
            // Reload Disqus with new theme
            var currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
            window.DISQUS.reset({
              reload: true,
              config: function() {
                this.page.url = '{{ page.url | absolute_url }}';
                this.page.identifier = '{{ page.url | absolute_url }}';
                this.page.colorScheme = currentTheme === 'dark' ? 'dark' : 'light';
              }
            });
          }
        });
      });
      
      observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['data-theme']
      });
    }
  </script>
  <noscript>
    Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
  </noscript>
{% endif %}
