{% comment %}
  Social Share Component
  Features: Native Web Share API with fallback, Twitter, LinkedIn, Copy Link
  Dark mode compatible, accessible, mobile-first
{% endcomment %}

<div class="social-share" id="social-share">
  <div class="social-share-label">
    <span class="icon is-small">
      <i class="fas fa-share-alt"></i>
    </span>
    <span>Share this article</span>
  </div>

  <div class="social-share-buttons">
    {% comment %} Native Share API button (mobile-first) {% endcomment %}
    <button
      class="button is-light social-share-btn"
      id="native-share-btn"
      onclick="nativeShare('{{ page.title | escape }}', '{{ page.url | absolute_url }}')"
      aria-label="Share this article"
      title="Share"
    >
      <span class="icon">
        <i class="fas fa-share-nodes"></i>
      </span>
      <span class="btn-text">Share</span>
    </button>

    {% comment %} Twitter Share {% endcomment %}
    <a
      class="button is-light social-share-btn twitter-btn"
      href="https://twitter.com/intent/tweet?text={{ page.title | url_encode }}&url={{ page.url | absolute_url | url_encode }}&via={{ site.twitter_username }}"
      target="_blank"
      rel="noopener noreferrer"
      aria-label="Share on Twitter"
      title="Share on Twitter"
    >
      <span class="icon">
        <i class="fab fa-twitter"></i>
      </span>
      <span class="btn-text">Twitter</span>
    </a>

    {% comment %} LinkedIn Share {% endcomment %}
    <a
      class="button is-light social-share-btn linkedin-btn"
      href="https://www.linkedin.com/sharing/share-offsite/?url={{ page.url | absolute_url | url_encode }}"
      target="_blank"
      rel="noopener noreferrer"
      aria-label="Share on LinkedIn"
      title="Share on LinkedIn"
    >
      <span class="icon">
        <i class="fab fa-linkedin"></i>
      </span>
      <span class="btn-text">LinkedIn</span>
    </a>

    {% comment %} Copy Link Button {% endcomment %}
    <button
      class="button is-light social-share-btn copy-link-btn"
      onclick="copyLink('{{ page.url | absolute_url }}')"
      aria-label="Copy link to clipboard"
      title="Copy Link"
    >
      <span class="icon">
        <i class="fas fa-link"></i>
      </span>
      <span class="btn-text">Copy Link</span>
    </button>
  </div>
</div>

{% comment %} Floating Share Bar for Mobile (appears on scroll) {% endcomment %}
<div class="floating-share-bar" id="floating-share-bar">
  <button
    class="floating-share-btn"
    onclick="nativeShare('{{ page.title | escape }}', '{{ page.url | absolute_url }}')"
    aria-label="Share this article"
    title="Share"
  >
    <span class="icon">
      <i class="fas fa-share-nodes"></i>
    </span>
  </button>

  <button
    class="floating-share-btn bookmark-floating-btn"
    onclick="toggleBookmark('{{ page.url }}', '{{ page.title | escape }}')"
    aria-label="Bookmark this article"
    title="Bookmark"
    id="floating-bookmark-btn"
  >
    <span class="icon">
      <i class="far fa-bookmark"></i>
    </span>
  </button>
</div>

{% comment %} Toast Notification for Copy Success {% endcomment %}
<div class="toast-notification" id="copy-toast">
  <span class="icon">
    <i class="fas fa-check-circle"></i>
  </span>
  <span>Link copied to clipboard!</span>
</div>

<script>
// Social Share Functions
(function() {
  'use strict';

  // Native Web Share API
  window.nativeShare = async function(title, url) {
    // Track share event
    if (typeof gtag !== 'undefined') {
      gtag('event', 'share', {
        'event_category': 'Social',
        'event_label': 'Native Share',
        'value': 1
      });
    }

    if (navigator.share) {
      try {
        await navigator.share({
          title: title,
          text: 'Check out this article: ' + title,
          url: url
        });
      } catch (err) {
        // User cancelled share or error occurred
        if (err.name !== 'AbortError') {
          console.error('Share failed:', err);
        }
      }
    } else {
      // Fallback: Show share options
      showShareModal(title, url);
    }
  };

  // Copy link to clipboard
  window.copyLink = async function(url) {
    try {
      await navigator.clipboard.writeText(url);
      showToast('Link copied to clipboard!');

      // Track copy event
      if (typeof gtag !== 'undefined') {
        gtag('event', 'copy_link', {
          'event_category': 'Social',
          'event_label': 'Copy Link',
          'value': 1
        });
      }
    } catch (err) {
      // Fallback for older browsers
      const textArea = document.createElement('textarea');
      textArea.value = url;
      textArea.style.position = 'fixed';
      textArea.style.left = '-999999px';
      document.body.appendChild(textArea);
      textArea.select();
      try {
        document.execCommand('copy');
        showToast('Link copied to clipboard!');
      } catch (err) {
        showToast('Failed to copy link', 'error');
      }
      document.body.removeChild(textArea);
    }
  };

  // Show toast notification
  function showToast(message, type = 'success') {
    const toast = document.getElementById('copy-toast');
    if (!toast) return;

    toast.textContent = message;
    toast.classList.add('show');

    setTimeout(() => {
      toast.classList.remove('show');
    }, 3000);
  }

  // Floating share bar visibility on scroll
  let lastScroll = 0;
  const floatingBar = document.getElementById('floating-share-bar');

  if (floatingBar) {
    window.addEventListener('scroll', () => {
      const scrollY = window.scrollY;

      // Show after 300px scroll
      if (scrollY > 300) {
        floatingBar.classList.add('visible');
      } else {
        floatingBar.classList.remove('visible');
      }
    }, { passive: true });
  }

  // Hide native share button if API not supported
  if (!navigator.share) {
    const nativeBtn = document.getElementById('native-share-btn');
    if (nativeBtn) {
      nativeBtn.style.display = 'none';
    }
  }

  // Track social share clicks
  document.querySelectorAll('.social-share-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const platform = this.classList.contains('twitter-btn') ? 'Twitter' :
                      this.classList.contains('linkedin-btn') ? 'LinkedIn' :
                      this.classList.contains('copy-link-btn') ? 'Copy Link' : 'Share';

      if (typeof gtag !== 'undefined') {
        gtag('event', 'share', {
          'event_category': 'Social',
          'event_label': platform,
          'value': 1
        });
      }
    });
  });
})();
</script>
