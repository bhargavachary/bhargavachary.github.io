{% comment %}
  Optimized image component with WebP support and lazy loading
  Usage: {% include optimized-image.html src="/path/to/image.jpg" alt="Alt text" %}
{% endcomment %}

{% comment %} Determine if the src is local (starts with /) or absolute/data {% endcomment %}
{% assign is_local = include.src | slice: 0, 1 %}
{% if is_local == '/' %}
  {% assign image_src = include.src | relative_url %}
{% else %}
  {% assign image_src = include.src %}
{% endif %}
{% assign image_alt = include.alt | default: "" %}
{% assign image_class = include.class | default: "" %}
{% assign loading = include.loading | default: "lazy" %}
{% assign width = include.width %}
{% assign height = include.height %}

<picture class="{{ image_class }}">
  {% comment %}
    WebP version for modern browsers.
    Only attempt simple extension swap for local assets; skip for absolute/data URLs.
  {% endcomment %}
  {% if is_local == '/' %}
    {% if image_src contains '.jpg' or image_src contains '.jpeg' or image_src contains '.png' %}
      {% assign webp_src = image_src | replace: '.jpg', '.webp' | replace: '.jpeg', '.webp' | replace: '.png', '.webp' %}
      <source srcset="{{ webp_src }}" type="image/webp">
    {% endif %}
  {% endif %}

  {% comment %} Original format as fallback - use immediate src, not lazy loading {% endcomment %}
  <img
    src="{{ image_src }}"
    alt="{{ image_alt }}"
    loading="{{ loading }}"
    {% if width %}width="{{ width }}"{% endif %}
    {% if height %}height="{{ height }}"{% endif %}
    class="{{ image_class }}"
    decoding="async"
  >
</picture>